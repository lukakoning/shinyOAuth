<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Usage • shinyOAuth</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Usage">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinyOAuth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/audit-logging.html">Audit logging and hooks</a></li>
    <li><a class="dropdown-item" href="../articles/authentication-flow.html">Authentication flow</a></li>
    <li><a class="dropdown-item" href="../articles/example-spotify.html">Example: Spotify login to display listening data</a></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Usage</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lukakoning/shinyOAuth/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Usage</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lukakoning/shinyOAuth/blob/master/vignettes/usage.Rmd" class="external-link"><code>vignettes/usage.Rmd</code></a></small>
      <div class="d-none name"><code>usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The ‘shinyOAuth’ package implements provider‑agnostic OAuth 2.0 and
OpenID Connect (OIDC) authorization/authentication for Shiny apps, built
with modern S7 classes and secure defaults. It streamlines the full
authorization/authentication flow:</p>
<ul>
<li>Building authorization URLs and redirecting unauthenticated
users</li>
<li>State, nonce, and PKCE generation, sealing, and verification</li>
<li>Authorization code exchange and token validation</li>
<li>Optional userinfo retrieval &amp; ID token signature/claims
validation</li>
<li>Proactive token refresh and re‑authentication triggers</li>
</ul>
<p>For a full step-by-step protocol breakdown, see the separate
vignette:
<code><a href="../articles/authentication-flow.html">vignette("authentication-flow", package = "shinyOAuth")</a></code>.</p>
<p>For a detailed explanation of audit logging key events during the
flow, see:
<code><a href="../articles/audit-logging.html">vignette("audit-logging", package = "shinyOAuth")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="minimal-shiny-module-example">Minimal Shiny module example<a class="anchor" aria-label="anchor" href="#minimal-shiny-module-example"></a>
</h2>
<p>Below is the minimal example using GitHub’s OAuth app (same as shown
in the README). Register an OAuth application at <a href="https://github.com/settings/developers" class="external-link uri">https://github.com/settings/developers</a> and set
environment variables <code>GITHUB_OAUTH_CLIENT_ID</code> and
<code>GITHUB_OAUTH_CLIENT_SECRET</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lukakoning/shinyOAuth" class="external-link">shinyOAuth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">provider</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_provider_github.html">oauth_provider_github</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_client.html">oauth_client</a></span><span class="op">(</span></span>
<span>  provider <span class="op">=</span> <span class="va">provider</span>,</span>
<span>  client_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_ID"</span><span class="op">)</span>,</span>
<span>  client_secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_SECRET"</span><span class="op">)</span>,</span>
<span>  redirect_uri <span class="op">=</span> <span class="st">"http://127.0.0.1:8100"</span>,</span>
<span>  scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"read:user"</span>, <span class="st">"user:email"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="co"># Include JavaScript dependency:</span></span>
<span>  <span class="fu"><a href="../reference/use_shinyOAuth.html">use_shinyOAuth</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="co"># Render login status &amp; user info:</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"login"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_module_server.html">oauth_module_server</a></span><span class="op">(</span><span class="st">"auth"</span>, <span class="va">client</span>, auto_redirect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">login</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">auth</span><span class="op">$</span><span class="va">authenticated</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">user_info</span> <span class="op">&lt;-</span> <span class="va">auth</span><span class="op">$</span><span class="va">token</span><span class="op">@</span><span class="va">userinfo</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"You are logged in!"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">pre</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">user_info</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"You are not logged in."</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># runApp(shinyApp(ui, server), port = 8100)</span></span></code></pre></div>
<p>Note that <code>ui</code> includes <code><a href="../reference/use_shinyOAuth.html">use_shinyOAuth()</a></code> to
load the necessary JavaScript dependency. Always place
<code><a href="../reference/use_shinyOAuth.html">use_shinyOAuth()</a></code> in your UI; otherwise, the module will not
function. You may place it near the top-level of your UI (e.g., inside
<code><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage()</a></code>, <code><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList()</a></code>, or
<code><a href="https://rstudio.github.io/bslib/reference/page.html" class="external-link">bslib::page()</a></code>).</p>
</div>
<div class="section level2">
<h2 id="manual-login-button-variant">Manual login button variant<a class="anchor" aria-label="anchor" href="#manual-login-button-variant"></a>
</h2>
<p>Below is an example where the user clicks a button to start the login
process instead of being redirected immediately on page load.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lukakoning/shinyOAuth" class="external-link">shinyOAuth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">provider</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_provider_github.html">oauth_provider_github</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_client.html">oauth_client</a></span><span class="op">(</span></span>
<span>  provider <span class="op">=</span> <span class="va">provider</span>,</span>
<span>  client_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_ID"</span><span class="op">)</span>,</span>
<span>  client_secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_SECRET"</span><span class="op">)</span>,</span>
<span>  redirect_uri <span class="op">=</span> <span class="st">"http://127.0.0.1:8100"</span>,</span>
<span>  scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"read:user"</span>, <span class="st">"user:email"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/use_shinyOAuth.html">use_shinyOAuth</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/actionButton.html" class="external-link">actionButton</a></span><span class="op">(</span><span class="st">"login_btn"</span>, <span class="st">"Login"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"login"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_module_server.html">oauth_module_server</a></span><span class="op">(</span></span>
<span>    <span class="st">"auth"</span>,</span>
<span>    <span class="va">client</span>,</span>
<span>    auto_redirect <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observeEvent.html" class="external-link">observeEvent</a></span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">login_btn</span>, <span class="op">{</span></span>
<span>    <span class="va">auth</span><span class="op">$</span><span class="fu">request_login</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">login</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">auth</span><span class="op">$</span><span class="va">authenticated</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">user_info</span> <span class="op">&lt;-</span> <span class="va">auth</span><span class="op">$</span><span class="va">token</span><span class="op">@</span><span class="va">userinfo</span></span>
<span>      <span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"You are logged in!"</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">pre</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">user_info</span><span class="op">)</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"You are not logged in."</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runApp.html" class="external-link">runApp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>, port <span class="op">=</span> <span class="fl">8100</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="making-authenticated-api-calls">Making authenticated API calls<a class="anchor" aria-label="anchor" href="#making-authenticated-api-calls"></a>
</h2>
<p>Once authenticated, you may want to call an API on behalf of the user
using the access token. Use <code><a href="../reference/client_bearer_req.html">client_bearer_req()</a></code> to quickly
build an authorized <code>httr2</code> request with the correct Bearer
token. See the example app below; it calls the GitHub API to obtain the
user’s repositories.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.posit.co/" class="external-link">shiny</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lukakoning/shinyOAuth" class="external-link">shinyOAuth</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">provider</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_provider_github.html">oauth_provider_github</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">client</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_client.html">oauth_client</a></span><span class="op">(</span></span>
<span>  provider <span class="op">=</span> <span class="va">provider</span>,</span>
<span>  client_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_ID"</span><span class="op">)</span>,</span>
<span>  client_secret <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"GITHUB_OAUTH_CLIENT_SECRET"</span><span class="op">)</span>,</span>
<span>  redirect_uri <span class="op">=</span> <span class="st">"http://127.0.0.1:8100"</span>,</span>
<span>  scopes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"read:user"</span>, <span class="st">"user:email"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/use_shinyOAuth.html">use_shinyOAuth</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/htmlOutput.html" class="external-link">uiOutput</a></span><span class="op">(</span><span class="st">"ui"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_module_server.html">oauth_module_server</a></span><span class="op">(</span></span>
<span>    <span class="st">"auth"</span>,</span>
<span>    <span class="va">client</span>,</span>
<span>    auto_redirect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">repositories</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/reactiveVal.html" class="external-link">reactiveVal</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/observe.html" class="external-link">observe</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/req.html" class="external-link">req</a></span><span class="op">(</span><span class="va">auth</span><span class="op">$</span><span class="va">authenticated</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Example additional API request using the access token</span></span>
<span>    <span class="co"># (e.g., fetch user repositories from GitHub)</span></span>
<span>    <span class="va">req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/client_bearer_req.html">client_bearer_req</a></span><span class="op">(</span><span class="va">auth</span><span class="op">$</span><span class="va">token</span>, <span class="st">"https://api.github.com/user/repos"</span><span class="op">)</span></span>
<span>    <span class="va">resp</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html" class="external-link">req_perform</a></span><span class="op">(</span><span class="va">req</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_status.html" class="external-link">resp_is_error</a></span><span class="op">(</span><span class="va">resp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu">repositories</span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">repos_data</span> <span class="op">&lt;-</span> <span class="fu">httr2</span><span class="fu">::</span><span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html" class="external-link">resp_body_json</a></span><span class="op">(</span><span class="va">resp</span>, simplifyVector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>      <span class="fu">repositories</span><span class="op">(</span><span class="va">repos_data</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Render username + their repositories</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/shiny/man/renderUI.html" class="external-link">renderUI</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="va">auth</span><span class="op">$</span><span class="va">authenticated</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">user_info</span> <span class="op">&lt;-</span> <span class="va">auth</span><span class="op">$</span><span class="va">token</span><span class="op">@</span><span class="va">userinfo</span></span>
<span>      <span class="va">repos</span> <span class="op">&lt;-</span> <span class="fu">repositories</span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span></span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"You are logged in as:"</span>, <span class="va">user_info</span><span class="op">$</span><span class="va">login</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        <span class="va">tags</span><span class="op">$</span><span class="fu">h4</span><span class="op">(</span><span class="st">"Your repositories:"</span><span class="op">)</span>,</span>
<span>        <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">repos</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="va">tags</span><span class="op">$</span><span class="fu">ul</span><span class="op">(</span></span>
<span>            <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">url</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="va">tags</span><span class="op">$</span><span class="fu">li</span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">a</span><span class="op">(</span>href <span class="op">=</span> <span class="va">url</span>, target <span class="op">=</span> <span class="st">"_blank"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span>, <span class="va">repos</span><span class="op">$</span><span class="va">html_url</span>, <span class="va">repos</span><span class="op">$</span><span class="va">full_name</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span>        <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>          <span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"Loading repositories..."</span><span class="op">)</span></span>
<span>        <span class="op">}</span></span>
<span>      <span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tags</span><span class="op">$</span><span class="fu">p</span><span class="op">(</span><span class="st">"You are not logged in."</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/runApp.html" class="external-link">runApp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span>, port <span class="op">=</span> <span class="fl">8100</span><span class="op">)</span></span></code></pre></div>
<p>For an example application which fetches data from the Spotify web
API, see:
<code><a href="../articles/example-spotify.html">vignette("example-spotify", package = "shinyOAuth")</a></code>.</p>
</div>
<div class="section level2">
<h2 id="async-mode-to-keep-ui-responsive">Async mode to keep UI responsive<a class="anchor" aria-label="anchor" href="#async-mode-to-keep-ui-responsive"></a>
</h2>
<p>By default, <code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code> performs network
operations (authorization code exchange, refresh, userinfo) on the main
R thread. During transient network errors the package retries with
backoff, and sleeping on the main thread can block the Shiny event loop
for the worker process.</p>
<p>To avoid blocking, enable async mode and configure a future
backend:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># in global.R or at app startup</span></span>
<span><span class="co"># Use a background process pool for promises</span></span>
<span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu">future</span><span class="fu">::</span><span class="va"><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">multisession</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">auth</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/oauth_module_server.html">oauth_module_server</a></span><span class="op">(</span></span>
<span>    <span class="st">"auth"</span>,</span>
<span>    <span class="va">client</span>,</span>
<span>    auto_redirect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    async <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># Run token exchange/refresh off the main thread</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># ...</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>If you need to keep <code>async = FALSE</code>, you may consider
reducing retry behaviour to limit blocking during provider incidents.
See ‘Global options’ and then ‘HTTP timeout/retries’.</p>
</div>
<div class="section level2">
<h2 id="global-options">Global options<a class="anchor" aria-label="anchor" href="#global-options"></a>
</h2>
<p>The package provides several global options to customize behavior.
Below is a list of all available options.</p>
<div class="section level3">
<h3 id="observabilitylogging">Observability/logging<a class="anchor" aria-label="anchor" href="#observabilitylogging"></a>
</h3>
<ul>
<li>
<code>options(shinyOAuth.print_errors = TRUE)</code> – concise error
lines (interactive / tests only)</li>
<li>
<code>options(shinyOAuth.print_traceback = TRUE)</code> – include
backtraces (interactive / tests only)</li>
<li>
<code>options(shinyOAuth.expose_error_body = TRUE)</code> – include
sanitized HTTP bodies (may reveal details)</li>
<li>
<code>options(shinyOAuth.trace_hook = function(event){ ... })</code>
– structured events (errors, http, etc.)</li>
<li>
<code>options(shinyOAuth.audit_hook = function(event){ ... })</code>
– separate audit stream</li>
</ul>
<p>See <code><a href="../articles/audit-logging.html">vignette("audit-logging", package = "shinyOAuth")</a></code>
for details about audit and trace hooks.</p>
</div>
<div class="section level3">
<h3 id="networkingsecurity">Networking/security<a class="anchor" aria-label="anchor" href="#networkingsecurity"></a>
</h3>
<ul>
<li>
<code>options(shinyOAuth.leeway = 30)</code> – default ID token
exp/iat leeway seconds</li>
<li>
<code>options(shinyOAuth.allowed_non_https_hosts = c("localhost", "127.0.0.1", "::1"))</code>
- allows hosts to use <code>http://</code> scheme instead of
<code>https://</code>
</li>
<li>
<code>options(shinyOAuth.allowed_hosts = c())</code> – when
non‑empty, restricts accepted hosts to this whitelist</li>
<li>
<code>options(shinyOAuth.allow_hs = TRUE)</code> – opt‑in HMAC
validation for ID tokens (HS256/HS384/HS512). Requires a strictly
server‑side <code>client_secret</code>
</li>
<li>
<code>options(shinyOAuth.client_assertion_ttl = 300L)</code> –
lifetime in seconds for JWT client assertions used with
<code>client_secret_jwt</code> or <code>private_key_jwt</code> token
endpoint authentication. Values below 60 seconds are coerced up to a
safe minimum; default is 300 seconds</li>
<li>
<code>options(shinyOAuth.state_fail_delay_ms = c(10, 30))</code> –
adds a small randomized delay (in milliseconds) before any state
validation failure (e.g., malformed token, IV/tag/ciphertext issues, or
GCM authentication failure). This helps reduce timing side‑channels
between different failure modes</li>
</ul>
<p>Note on <code>allowed_hosts</code>: patterns support globs
(<code>*</code>, <code>?</code>). Using a catch‑all like
<code>"*"</code> matches any host and effectively disables endpoint host
restrictions (scheme rules still apply). Avoid this unless you truly
intend to accept any host; prefer pinning to your domain(s), e.g.,
<code>c(".example.com")</code>.</p>
</div>
<div class="section level3">
<h3 id="http-settings-timeout-retries-user-agent">HTTP settings (timeout, retries, user agent)<a class="anchor" aria-label="anchor" href="#http-settings-timeout-retries-user-agent"></a>
</h3>
<ul>
<li>
<code>options(shinyOAuth.timeout = 5)</code> – default HTTP timeout
(seconds) applied to all outbound requests (discovery, JWKS, token
exchange, userinfo). Increase if your provider/network is slow; can be
overridden per‑session via <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code> before making
requests</li>
<li>
<code>options(shinyOAuth.retry_max_tries = 3L)</code> – maximum
attempts for transient failures (network errors, 408, 429, 5xx)</li>
<li>
<code>options(shinyOAuth.retry_backoff_base = 0.5)</code> – base
backoff in seconds used for exponential backoff with jitter</li>
<li>
<code>options(shinyOAuth.retry_backoff_cap = 5)</code> – per‑attempt
cap on backoff seconds (before jitter)</li>
<li>
<code>options(shinyOAuth.retry_status = c(408L, 429L, 500:599))</code>
– HTTP statuses considered transient and retried</li>
<li>
<code>options(shinyOAuth.user_agent = "shinyOAuth/&lt;version&gt; R/&lt;version&gt; httr2/&lt;version&gt;")</code>
– override the default User‑Agent header applied to all outbound
requests. By default this string is built dynamically from the installed
package/runtime versions; set a custom string here if your organization
requires a specific format</li>
</ul>
</div>
<div class="section level3">
<h3 id="development-softening">Development softening<a class="anchor" aria-label="anchor" href="#development-softening"></a>
</h3>
<ul>
<li>
<code>options(shinyOAuth.skip_browser_token = TRUE)</code> – skip
browser cookie binding</li>
<li>
<code>options(shinyOAuth.skip_id_sig = TRUE)</code> – skip ID token
signature verification</li>
</ul>
<p>Don’t enable these in production. They disable key security checks
and are intended for local testing only. Use
<code><a href="../reference/error_on_softened.html">error_on_softened()</a></code> at startup to fail fast if softening
flags are enabled in an environment where they should not be.</p>
</div>
<div class="section level3">
<h3 id="state-envelope-size-caps">State envelope size caps<a class="anchor" aria-label="anchor" href="#state-envelope-size-caps"></a>
</h3>
<ul>
<li>
<code>options(shinyOAuth.state_max_token_chars = 8192)</code> –
maximum allowed length of the base64url-encoded <code>state</code> query
parameter</li>
<li>
<code>options(shinyOAuth.state_max_wrapper_bytes = 8192)</code> –
maximum decoded byte size of the outer JSON wrapper (before
parsing)</li>
<li>
<code>options(shinyOAuth.state_max_ct_b64_chars = 8192)</code> –
maximum allowed length of the base64url-encoded ciphertext inside the
wrapper</li>
<li>
<code>options(shinyOAuth.state_max_ct_bytes = 8192)</code> – maximum
decoded byte size of the ciphertext before attempting AES-GCM
decrypt</li>
</ul>
<p>These prevent maliciously large state parameters from causing
excessive CPU or memory usage during decoding and decryption.</p>
</div>
</div>
<div class="section level2">
<h2 id="browser-cookie-preventing-xss">Browser cookie &amp; preventing XSS<a class="anchor" aria-label="anchor" href="#browser-cookie-preventing-xss"></a>
</h2>
<p><code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code> binds the browser and server
session with a short‑lived cookie that must be readable from client‑side
JavaScript to bridge values into Shiny.</p>
<p>The cookie ensures that the same browser which initiated login is the
one receiving the callback. This specifically prevents an attack where
an attacker tricks a user into clicking a link which initiates login for
the attacker’s account, confusing the user into logging in as the
attacker (login confusion).</p>
<p>The cookie is set with the <code>HttpOnly</code> flag disabled so
that it can be read by JavaScript. This is necessary to bridge the
cookie value into Shiny. However, this means that if your app has XSS
vulnerabilities, an attacker could read the cookie too.</p>
<p>While this is a relatively limited attack vector, you should still
take care to prevent XSS vulnerabilities in your app. An important
mitigation is to sanitize user inputs before rendering them in the UI
(e.g., using <code><a href="https://rstudio.github.io/htmltools/reference/htmlEscape.html" class="external-link">htmltools::htmlEscape()</a></code>).</p>
</div>
<div class="section level2">
<h2 id="multiprocess-deployments-share-state-store-key">Multi‑process deployments: share state store &amp; key<a class="anchor" aria-label="anchor" href="#multiprocess-deployments-share-state-store-key"></a>
</h2>
<p>When you run multiple Shiny R processes (e.g., multiple workers,
Shiny Server Pro, RStudio Connect, Docker/Kubernetes replicas, or any
non‑sticky load balancer), you must ensure that:</p>
<ul>
<li>All workers share the same state store (e.g.,
<code><a href="https://cachem.r-lib.org/reference/cache_disk.html" class="external-link">cachem::cache_disk()</a></code> pointing at a shared directory, or a
custom cachem backend; the default <code><a href="https://cachem.r-lib.org/reference/cache_mem.html" class="external-link">cachem::cache_mem()</a></code> is
per‑process only and is then not shared)</li>
<li>All workers share the same state key (e.g., read from environment
variable; by default, a random key is generated per client instance
which is then not shared)</li>
</ul>
<p>This is because during the authorization code + PKCE flow,
‘shinyOAuth’ creates an encrypted “state envelope” which is stored in a
cache (the state_store) and echoed back via the <code>state</code> query
parameter. The envelope is sealed with AES‑GCM using your state_key. If
the callback lands on a different worker than the one that initiated
login, that worker must be able to both read the cached entry and
decrypt the envelope using the same key. If workers have different keys,
decryption will fail and the login flow will abort with a state
error.</p>
<p>When providing a custom state key, please ensure it has high entropy
(minimum 32 characters or 32 raw bytes; recommended 64–128 characters)
to prevent offline guessing attacks against the encrypted state. Do not
use short or human‑memorable passphrases.</p>
</div>
<div class="section level2">
<h2 id="security-checklist">Security checklist<a class="anchor" aria-label="anchor" href="#security-checklist"></a>
</h2>
<p>Below is a checklist of things you may want to think about when
bringing your app to production:</p>
<ul>
<li>Use HTTPS everywhere in production</li>
<li>Verify issuer used in your provider is correct</li>
<li>In your <code>OAuthProvider</code>, set as many of the security
options as possible; for instance, set
<code>jwks_host_issuer_match</code>/<code>jwks_host_allow_only</code>
(if your provider uses a different host for JWKS)</li>
<li>Have your <code>OAuthClient</code> request the minimum scopes
necessary; give your app registration only the permissions it needs</li>
<li>Do not show <code>$error_description</code> to your users; never
expose tokens in UI or logs</li>
<li>Keep secrets safe in environment variables (e.g.,
<code>OAUTH_CLIENT_ID</code>, <code>OAUTH_CLIENT_SECRET</code>)</li>
<li>Sanitize user inputs before rendering them in the UI (e.g., using
<code><a href="https://rstudio.github.io/htmltools/reference/htmlEscape.html" class="external-link">htmltools::htmlEscape()</a></code>)</li>
<li>Make use of audit logging (see
<code><a href="../articles/audit-logging.html">vignette("audit-logging", package = "shinyOAuth")</a></code>) and
monitor these logs</li>
<li>Use a provider which enforces strong authentication (e.g.,
multi-factor authentication)</li>
<li>Set Content Security Policy (CSP) headers to restrict resource
loading and mitigate XSS attacks; (requires middleware; can’t be done in
Shiny)</li>
<li>Log IP addresses of those accessing your app (requires middleware;
can’t be done in Shiny)</li>
</ul>
<p>While this R package has been developed with care and the OAuth
2.0/OIDC protocols contain many security features, no guarantees can be
made in the realm of cybersecurity. For highly sensitive applications,
consider a layered (‘defense-in-depth’) approach to security (for
example, adding an IP whitelist as an additional safeguard).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Audit logging and hooks • shinyOAuth</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Audit logging and hooks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinyOAuth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/audit-logging.html">Audit logging and hooks</a></li>
    <li><a class="dropdown-item" href="../articles/authentication-flow.html">Authentication flow</a></li>
    <li><a class="dropdown-item" href="../articles/example-spotify.html">Example: Spotify login to display listening data</a></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Usage</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lukakoning/shinyOAuth/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Audit logging and hooks</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lukakoning/shinyOAuth/blob/master/vignettes/audit-logging.Rmd" class="external-link"><code>vignettes/audit-logging.Rmd</code></a></small>
      <div class="d-none name"><code>audit-logging.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>‘shinyOAuth’ emits structured audit events at key milestones in the
OAuth 2.0 / OIDC flow. These events are designed to help detect
anomalous activity (e.g., brute force, replay, or configuration errors)
without leaking sensitive data. Events only include redacted or digested
identifiers (for example, SHA-256 digests of client ids, state values,
or subject ids).</p>
<p>This vignette covers:</p>
<ul>
<li>How to register audit hooks to export/store events</li>
<li>Which audit events are emitted</li>
<li>What fields are included in each event</li>
<li>Best practices</li>
</ul>
</div>
<div class="section level2">
<h2 id="receiving-audit-events">Receiving audit events<a class="anchor" aria-label="anchor" href="#receiving-audit-events"></a>
</h2>
<p>There are two hook options you can set. Both receive the same event
object (a named list) and should be fast, non-blocking, and never
throw.</p>
<ul>
<li>
<code>options(shinyOAuth.audit_hook = function(event) { ... })</code>
— intended for audit-specific sinks (SIEM/ELK/etc.)</li>
<li>
<code>options(shinyOAuth.trace_hook = function(event) { ... })</code>
— a more general-purpose tracing hook used for both audit events and
error traces</li>
</ul>
<p>Example: print all audit events to the console during
development.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>shinyOAuth.audit_hook <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">ev</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"[AUDIT] %s %s\n"</span>, <span class="va">ev</span><span class="op">$</span><span class="va">type</span>, <span class="va">ev</span><span class="op">$</span><span class="va">trace_id</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ev</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>To stop receiving events, unset the option:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>shinyOAuth.audit_hook <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="event-catalog">Event catalog<a class="anchor" aria-label="anchor" href="#event-catalog"></a>
</h2>
<p>All audit events share the following base shape:</p>
<ul>
<li>
<code>type</code>: a string starting with
<code>audit_...</code>
</li>
<li>
<code>trace_id</code>: a short correlation id for linking related
records</li>
<li>Additional key/value fields depending on the event</li>
<li>
<code>timestamp</code>: POSIXct time when the event was created
(from <code><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time()</a></code>)</li>
</ul>
<div class="section level3">
<h3 id="shiny-session-context">Shiny session context<a class="anchor" aria-label="anchor" href="#shiny-session-context"></a>
</h3>
<p>When events are emitted from within a Shiny session (e.g., the
authentication module), a JSON-friendly <code>shiny_session</code> list
is attached to every event to correlate audit activity with the HTTP
request and session. The structure is designed to be directly
serializable with <code><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">jsonlite::toJSON()</a></code>:</p>
<ul>
<li>
<code>shiny_session$token</code>: the Shiny per-session token
(<code>session$token</code>) when available.</li>
<li>
<code>shiny_session$http</code>: a compact HTTP summary with fields:
<ul>
<li>
<code>method</code>, <code>path</code>, <code>query_string</code>,
<code>host</code>, <code>scheme</code>, <code>remote_addr</code>
</li>
<li>
<code>headers</code>: a list of request headers derived from
<code>HTTP_*</code> environment variables, with lowercase names (e.g.,
<code>user_agent</code>, <code>x_forwarded_for</code>).</li>
</ul>
</li>
</ul>
<p>Note: the raw <code>session$request</code> from Shiny is not included
to keep the event JSON-serializable and concise.</p>
<p>Note: the <code>shiny_session$http</code> summary intentionally
captures all <code>HTTP_*</code> headers and the raw
<code>QUERY_STRING</code> from the active Shiny request. If you forward
events to a log sink, this may include sensitive material such as the
authorization code, <code>state</code>, and every request header
(including <code>Cookie</code>, <code>Authorization</code>, and other
bearer tokens). Consider stripping or redacting sensitive headers and
query parameters in your hook before exporting.</p>
</div>
<div class="section level3">
<h3 id="authorization-redirect-issuance">Authorization redirect issuance<a class="anchor" aria-label="anchor" href="#authorization-redirect-issuance"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_redirect_issued">Event: <code>audit_redirect_issued</code><a class="anchor" aria-label="anchor" href="#event-audit_redirect_issued"></a>
</h4>
<ul>
<li><p>When: after <code><a href="../reference/prepare_call.html">prepare_call()</a></code> builds the authorization
URL</p></li>
<li>
<p>Context:</p>
<ul>
<li>
<code>provider</code>, <code>issuer</code>
</li>
<li><code>client_id_digest</code></li>
<li><code>state_digest</code></li>
<li><code>browser_token_digest</code></li>
<li>
<code>pkce_method</code> (e.g., <code>S256</code>,
<code>plain</code>, or <code>NA</code>)</li>
<li>
<code>nonce_present</code> (logical)</li>
<li><code>scopes_count</code></li>
<li><code>redirect_uri</code></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="callback-received">Callback received<a class="anchor" aria-label="anchor" href="#callback-received"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_callback_received">Event: <code>audit_callback_received</code><a class="anchor" aria-label="anchor" href="#event-audit_callback_received"></a>
</h4>
<ul>
<li>When: <code><a href="../reference/handle_callback.html">handle_callback()</a></code> begins processing a
callback</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>code_digest</code>,
<code>state_digest</code>, <code>browser_token_digest</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="callback-validation">Callback validation<a class="anchor" aria-label="anchor" href="#callback-validation"></a>
</h3>
<p>Callback validation spans decryption + freshness + binding of the
encrypted payload as well as subsequent checks of values bound to the
state (browser token, PKCE code verifier, nonce). Each check emits
either a success (only once for the payload) or a failure audit
event.</p>
<div class="section level4">
<h4 id="event-audit_callback_validation_success">Event: <code>audit_callback_validation_success</code><a class="anchor" aria-label="anchor" href="#event-audit_callback_validation_success"></a>
</h4>
<ul>
<li>When: the encrypted <code>state</code> payload has been decrypted
and verified for freshness and client/provider binding (emitted from
<code><a href="../reference/state_payload_decrypt_validate.html">state_payload_decrypt_validate()</a></code>)</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>state_digest</code>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-audit_callback_validation_failed">Event: <code>audit_callback_validation_failed</code><a class="anchor" aria-label="anchor" href="#event-audit_callback_validation_failed"></a>
</h4>
<ul>
<li>When: a validation step fails prior to token exchange</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>state_digest</code>,
<code>phase</code>, <code>error_class</code> (+
<code>browser_token_digest</code> when phase is
<code>browser_token_validation</code>)</li>
<li>Phases include: <code>payload_validation</code>,
<code>browser_token_validation</code>,
<code>pkce_verifier_validation</code>,
<code>nonce_validation</code>
</li>
<li>Note: Failures related to state store access (lookup/removal) are
reported as their own events (see below) rather than using the
<code>callback_validation_failed</code> event.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="state-store-access">State store access<a class="anchor" aria-label="anchor" href="#state-store-access"></a>
</h3>
<p>State retrieval and removal of the single-use state entry are emitted
as separate events by <code><a href="../reference/state_store_get_remove.html">state_store_get_remove()</a></code>.</p>
<div class="section level4">
<h4 id="event-audit_state_store_lookup_failed">Event: <code>audit_state_store_lookup_failed</code><a class="anchor" aria-label="anchor" href="#event-audit_state_store_lookup_failed"></a>
</h4>
<ul>
<li>When: retrieving the single-use state entry from the configured
<code>state_store</code> fails (missing, malformed, or underlying cache
error)</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>state_digest</code>,
<code>error_class</code>, <code>phase</code>
(<code>state_store_lookup</code>)</li>
<li>Notes: The flow aborts with an invalid state error.</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-audit_state_store_removal_failed">Event: <code>audit_state_store_removal_failed</code><a class="anchor" aria-label="anchor" href="#event-audit_state_store_removal_failed"></a>
</h4>
<ul>
<li>When: removal of the single-use state entry (enforcing one-time use)
fails</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>state_digest</code>,
<code>error_class</code>, <code>phase</code>
(<code>state_store_removal</code>)</li>
<li>Notes: A failure to remove also aborts the flow with an invalid
state error; the event is emitted best-effort and will never itself
throw.</li>
</ul>
<p>Digest differences: For <code>audit_callback_validation_failed</code>
during payload decryption (<code>phase = "payload_validation"</code>)
the <code>state_digest</code> is computed from the encrypted payload
(plaintext not yet available). For state store events the digest
reflects the plaintext state string.</p>
</div>
</div>
<div class="section level3">
<h3 id="token-exchange">Token exchange<a class="anchor" aria-label="anchor" href="#token-exchange"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_token_exchange">Event: <code>audit_token_exchange</code><a class="anchor" aria-label="anchor" href="#event-audit_token_exchange"></a>
</h4>
<ul>
<li>When: authorization code successfully exchanged for tokens</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>code_digest</code>,
<code>used_pkce</code>, <code>received_id_token</code>,
<code>received_refresh_token</code>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-audit_token_exchange_error">Event: <code>audit_token_exchange_error</code><a class="anchor" aria-label="anchor" href="#event-audit_token_exchange_error"></a>
</h4>
<ul>
<li>When: token exchange fails</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>code_digest</code>,
<code>error_class</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="login-result">Login result<a class="anchor" aria-label="anchor" href="#login-result"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_login_success">Event: <code>audit_login_success</code><a class="anchor" aria-label="anchor" href="#event-audit_login_success"></a>
</h4>
<ul>
<li>When: token set is verified and an <code>OAuthToken</code> is
created</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>sub_digest</code>,
<code>refresh_token_present</code>, <code>expires_at</code>
</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-audit_login_failed">Event: <code>audit_login_failed</code><a class="anchor" aria-label="anchor" href="#event-audit_login_failed"></a>
</h4>
<ul>
<li>When: surface-level login failure during callback handling in the
Shiny module</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>phase</code>
(<code>sync_token_exchange</code>|<code>async_token_exchange</code>),
<code>error_class</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="logout-and-session-clears">Logout and session clears<a class="anchor" aria-label="anchor" href="#logout-and-session-clears"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_logout">Event: <code>audit_logout</code><a class="anchor" aria-label="anchor" href="#event-audit_logout"></a>
</h4>
<ul>
<li>When: <code>values$logout()</code> is called on the module</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>reason</code> (default
<code>manual_logout</code>)</li>
</ul>
</div>
<div class="section level4">
<h4 id="event-audit_session_cleared">Event: <code>audit_session_cleared</code><a class="anchor" aria-label="anchor" href="#event-audit_session_cleared"></a>
</h4>
<ul>
<li>When: the module clears the token reactively</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>reason</code>
</li>
<li>Reasons include: <code>refresh_failed_async</code>,
<code>refresh_failed_sync</code>, <code>reauth_window</code>,
<code>token_expired</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="refresh-failures-while-keeping-the-session-indefinite-sessions">Refresh failures while keeping the session (indefinite
sessions)<a class="anchor" aria-label="anchor" href="#refresh-failures-while-keeping-the-session-indefinite-sessions"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_refresh_failed_but_kept_session">Event: <code>audit_refresh_failed_but_kept_session</code><a class="anchor" aria-label="anchor" href="#event-audit_refresh_failed_but_kept_session"></a>
</h4>
<ul>
<li>When: a token refresh attempt fails but the module is configured not
to clear the session (i.e., <code>indefinite_session = TRUE</code> in
<code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>)</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>reason</code>
(<code>refresh_failed_async</code>|<code>refresh_failed_sync</code>),
<code>kept_token</code> (TRUE), <code>error_class</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="browser-cookiewebcrypto-error">Browser cookie/WebCrypto error<a class="anchor" aria-label="anchor" href="#browser-cookiewebcrypto-error"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_browser_cookie_error">Event: <code>audit_browser_cookie_error</code><a class="anchor" aria-label="anchor" href="#event-audit_browser_cookie_error"></a>
</h4>
<ul>
<li>When: the browser reports it could not set/read the module cookie or
WebCrypto is unavailable</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>reason</code>,
<code>url_protocol</code>
</li>
<li>Notes: This typically indicates that third-party cookies are
blocked, all cookies are disabled, or the WebCrypto API is unavailable
in the environment (e.g., very old browsers or restrictive embedded
webviews).</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="invalid-browser-token">Invalid browser token<a class="anchor" aria-label="anchor" href="#invalid-browser-token"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_invalid_browser_token">Event: <code>audit_invalid_browser_token</code><a class="anchor" aria-label="anchor" href="#event-audit_invalid_browser_token"></a>
</h4>
<ul>
<li>When: the module receives an invalid <code>shinyOAuth_sid</code>
value from the browser and requests regeneration</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>reason</code>,
<code>length</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="token-refresh">Token refresh<a class="anchor" aria-label="anchor" href="#token-refresh"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_token_refresh">Event: <code>audit_token_refresh</code><a class="anchor" aria-label="anchor" href="#event-audit_token_refresh"></a>
</h4>
<ul>
<li>When: <code><a href="../reference/refresh_token.html">refresh_token()</a></code> successfully refreshes the access
token</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>had_refresh_token</code>,
<code>new_expires_at</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="userinfo-fetch">Userinfo fetch<a class="anchor" aria-label="anchor" href="#userinfo-fetch"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_userinfo">Event: <code>audit_userinfo</code><a class="anchor" aria-label="anchor" href="#event-audit_userinfo"></a>
</h4>
<ul>
<li>When: <code><a href="../reference/get_userinfo.html">get_userinfo()</a></code> successfully retrieves user
information</li>
<li>Context: <code>provider</code>, <code>issuer</code>,
<code>client_id_digest</code>, <code>sub_digest</code>
</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="state-parsing-failures">State parsing failures<a class="anchor" aria-label="anchor" href="#state-parsing-failures"></a>
</h3>
<p>State parsing failures occur while decoding and validating the
encrypted wrapper prior to extracting the logical state value.</p>
<div class="section level4">
<h4 id="event-audit_state_parse_failure">Event: <code>audit_state_parse_failure</code><a class="anchor" aria-label="anchor" href="#event-audit_state_parse_failure"></a>
</h4>
<ul>
<li>When: the encrypted state wrapper or its components fail
validation/decoding</li>
<li>Context: includes <code>phase = decrypt</code>, a
<code>reason</code> code (e.g., <code>token_b64_invalid</code>,
<code>iv_missing</code>, <code>tag_len_invalid</code>),
<code>token_digest</code>, and any additional details (such as lengths).
Emitted best-effort from parsing utilities and never interferes with
control flow.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="modulesession-lifecycle">Module/session lifecycle<a class="anchor" aria-label="anchor" href="#modulesession-lifecycle"></a>
</h3>
<div class="section level4">
<h4 id="event-audit_session_started">Event: <code>audit_session_started</code><a class="anchor" aria-label="anchor" href="#event-audit_session_started"></a>
</h4>
<ul>
<li>When: the authentication module (<code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>)
is initialized for a Shiny session</li>
<li>Context: <code>module_id</code>, <code>ns_prefix</code>,
<code>client_provider</code>, <code>client_issuer</code>,
<code>client_id_digest</code>, plus the standard
<code>shiny_session</code> context described above</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="where-to-find-these-in-code">Where to find these in code<a class="anchor" aria-label="anchor" href="#where-to-find-these-in-code"></a>
</h2>
<ul>
<li>Redirect and login audits are emitted from
<code>R/methods__login.R</code>
</li>
<li>Module lifecycle/session audits are emitted from
<code>R/oauth_module_server.R</code>
</li>
<li>All events flow through <code>audit_event()</code> defined in
<code>R/errors.R</code>, which delegates to the hook options</li>
</ul>
</div>
<div class="section level2">
<h2 id="best-practices-for-audit-hooks">Best practices for audit hooks<a class="anchor" aria-label="anchor" href="#best-practices-for-audit-hooks"></a>
</h2>
<ul>
<li>Keep hooks fast and never throw; wrap internals with
<code>try(..., silent = TRUE)</code> if needed</li>
<li>Export to your logging backend in JSON for easy parsing</li>
<li>Do not attempt to reverse digests; use them only for
correlation</li>
<li>Consider adding a host/app identifier to the record before
exporting</li>
<li>If you also want error traces, set
<code>options(shinyOAuth.trace_hook=...)</code>
</li>
</ul>
<p>Example JSON export hook:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">json_hook</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ev</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span></span>
<span>        <span class="va">line</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://jeroen.r-universe.dev/jsonlite/reference/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">ev</span>, auto_unbox <span class="op">=</span> <span class="cn">TRUE</span>, null <span class="op">=</span> <span class="st">"null"</span><span class="op">)</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="va">line</span>, <span class="st">"\n"</span>, file <span class="op">=</span> <span class="st">"shinyOAuth-audit.log"</span>, append <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>shinyOAuth.audit_hook <span class="op">=</span> <span class="va">json_hook</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Changelog • shinyOAuth</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Changelog"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">shinyOAuth</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/audit-logging.html">Audit logging and hooks</a></li>
    <li><a class="dropdown-item" href="../articles/authentication-flow.html">Authentication flow</a></li>
    <li><a class="dropdown-item" href="../articles/example-spotify.html">Example: Spotify login to display listening data</a></li>
    <li><a class="dropdown-item" href="../articles/usage.html">Usage</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lukakoning/shinyOAuth/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-news">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Changelog</h1>
      <small>Source: <a href="https://github.com/lukakoning/shinyOAuth/blob/master/NEWS.md" class="external-link"><code>NEWS.md</code></a></small>
    </div>

    <div class="section level2">
<h2 class="pkg-version" data-toc-text="development version" id="shinyoauth-development-version">shinyOAuth (development version)<a class="anchor" aria-label="anchor" href="#shinyoauth-development-version"></a></h2>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.4.0" id="shinyoauth-040">shinyOAuth 0.4.0<a class="anchor" aria-label="anchor" href="#shinyoauth-040"></a></h2>
<ul><li>
<p>‘mirai’ &amp; async backend improvements:</p>
<ul><li>Warnings and messages emitted in async workers (e.g., missing <code>expires_in</code> from token response) are now captured and re-emitted on the main process so they appear in the R console. This includes conditions from user-supplied <code>trace_hook</code> / <code>audit_hook</code> functions: warnings, messages, and errors (surfaced as warnings) all propagate back to the main thread. Replay can be disabled via <code>options(shinyOAuth.replay_async_conditions = FALSE)</code>.</li>
<li>Async callback flow no longer serializes the full client object (including potentially non-serializable custom <code>state_store</code> / JWKS cache backends) into the worker context. The <code>state_store</code> (already consumed on the main thread) is replaced with a lightweight serializable dummy before dispatch. If the client still fails serialization, the flow falls back to synchronous execution with an explicit warning instead of an opaque runtime error.</li>
<li>Further reduced serialization overhead towards async workers by using certain functions from the package namespace directly.</li>
<li>Detect active daemons via <code><a href="https://mirai.r-lib.org/reference/daemons_set.html" class="external-link">mirai::daemons_set()</a></code> instead of <code><a href="https://mirai.r-lib.org/reference/status.html" class="external-link">mirai::status()</a></code>. Falls back to <code><a href="https://mirai.r-lib.org/reference/info.html" class="external-link">mirai::info()</a></code> on older ‘mirai’ versions that lack <code><a href="https://mirai.r-lib.org/reference/daemons_set.html" class="external-link">mirai::daemons_set()</a></code> (&lt; 2.3.0).</li>
<li>Configurable per-task timeout via <code>options(shinyOAuth.async_timeout)</code> (milliseconds); timed-out ‘mirai’ tasks are automatically cancelled by the dispatcher. Default is <code>NULL</code> (no timeout).</li>
<li>Async audit events now include a <code>mirai_error_type</code> field. This classifies mirai transport-level failures separately from application-level errors.</li>
<li>Prevent ‘mirai’ warning spam about ‘stats’ maybe not being available in workers.</li>
</ul></li>
<li>
<p>ID token validation (<code>validate_id_token()</code>):</p>
<ul><li>Now enforces RFC 7515 section 4.1.11 critical header parameter (<code>crit</code>) processing rules. Tokens containing unsupported critical extensions are rejected with a <code>shinyOAuth_id_token_error</code>. The current implementation supports no critical extensions, so any <code>crit</code> presence triggers rejection.</li>
<li>Now validates the <code>at_hash</code> (Access Token hash) claim when present in the ID token (per OIDC Core section 3.1.3.8 and 3.2.2.9). If the claim exists, the access token binding is verified; a mismatch raises a <code>shinyOAuth_id_token_error</code>. New <code>id_token_at_hash_required</code> property on <code>OAuthProvider</code> (default <code>FALSE</code>) forces login to fail when the ID token does not contain an <code>at_hash</code> claim.</li>
<li>Now validates, for refreshed ID tokens, per OIDC Core section 12.2, <code>iss</code> and <code>aud</code> claims against the original ID token’s values (not just the provider configuration) to cover edge cases with multi-tenant providers or rotating issuer URIs. Enforced in both validated and non-validated code paths.</li>
<li>Now detects encrypted ID tokens (JWE compact serialization, 5 dot-separated segments) early and raises a clear <code>shinyOAuth_id_token_error</code> instead of letting a confusing alg/typ/parse failure propagate.</li>
<li>Now validates the <code>auth_time</code> claim when <code>max_age</code> is present in <code>extra_auth_params</code> (OIDC Core section 3.1.2.1).</li>
<li>Now enforces a maximum ID token lifetime (<code>exp - iat</code>) per OIDC Core section 3.1.3.7; tokens with unreasonably long lifetimes are rejected with a <code>shinyOAuth_id_token_error</code>. Configure via <code>options(shinyOAuth.max_id_token_lifetime = &lt;seconds&gt;)</code> (default of <code>86400</code> which is 24 hours). Set to <code>Inf</code> to disable the check.</li>
</ul></li>
<li>
<p>Stricter state store usage:</p>
<ul><li>
<code><a href="../reference/custom_cache.html">custom_cache()</a></code> gains an optional <code>take</code> parameter for atomic get-and-delete.</li>
<li>
<code><a href="../reference/state_store_get_remove.html">state_store_get_remove()</a></code> prefers <code>$take()</code> when available; falls back to <code>$get()</code> + <code>$remove()</code> with a mandatory post-removal absence check (instead of trusting <code>$remove()</code> return values).</li>
<li>Non-<code><a href="https://cachem.r-lib.org/reference/cache_mem.html" class="external-link">cachem::cache_mem()</a></code> stores without <code>$take()</code> now error by default to prevent TOCTOU replay attacks in shared/multi-worker deployments. To bypass this error, operators must explicitly acknowledge the risk by setting <code>options(shinyOAuth.allow_non_atomic_state_store = TRUE)</code>, which downgrades the error to a warning.</li>
<li>
<code>OAuthClient</code> validator now validates <code>$take()</code> signature when present.</li>
<li>The <code>$remove()</code> return value is no longer relied upon in the fallback path; the post-removal <code>$get()</code> absence check is authoritative.</li>
</ul></li>
<li><p>Stricter JWKS cache handling: JWKS cache key now includes host-policy fields (<code>jwks_host_issuer_match</code>, <code>jwks_host_allow_only</code>). Previously, two provider configs for the same issuer with different host policies shared the same cache entry, allowing a relaxed-policy provider to populate the cache and a strict-policy provider to skip host validation on cache hit. Cache entries now also store the JWKS source host and re-validate it against the current provider policy on read (defense-in-depth).</p></li>
<li><p>Stricter URL validation: <code>OAuthClient</code> now rejects redirect URIs containing fragments (per RFC 6749, section 3.1.2); <code>OAuthProvider</code> now rejects issuer identifiers containing query or fragment components, covering both <code><a href="../reference/oauth_provider_oidc_discover.html">oauth_provider_oidc_discover()</a></code> and manual construction of providers.</p></li>
<li><p>Stricter state payload parsing: callback <code>state</code> now rejects embedded NUL bytes before JSON decoding.</p></li>
<li><p>Stricter response size validation: enforce max response body size on all outbound HTTP endpoints (token, introspection, userinfo, OIDC discovery, JWKS). Curl aborts the transfer early when <code>Content-Length</code> exceeds the limit; a post-download guard catches chunked responses. Default 1 MiB, configurable via <code>options(shinyOAuth.max_body_bytes)</code>.</p></li>
<li>
<p><code>OAuthProvider</code> (S7 class):</p>
<ul><li>
<code>leeway</code> validator now rejects non-finite values (<code>Inf</code>, <code>-Inf</code>, <code>NaN</code>). Previously these passed validation but were silently coerced to 0 at runtime, effectively disabling clock-skew tolerance.</li>
<li>Reserved OAuth parameter blocking in <code>extra_auth_params</code> and <code>extra_token_params</code> is now case-insensitive and trims whitespace.</li>
<li>Vector inputs for <code>pkce_method</code> and URL parameters (<code>auth_url</code>, <code>token_url</code>, <code>userinfo_url</code>, <code>introspection_url</code>, <code>revocation_url</code>) now produce clear scalar-input errors instead of cryptic coercion failures.</li>
</ul></li>
<li>
<p><code>OAuthClient</code> (S7 class):</p>
<ul><li>Gains a <code>claims_validation</code> property; when the client sends a structured <code>claims</code> request parameter with <code>essential = TRUE</code> entries, this setting controls whether the returned ID token and/or userinfo response are checked for those essential claims (similar to <code>scope_validation</code>).</li>
<li>Gains a <code>required_acr_values</code> property; enables client-side enforcement of the OIDC <code>acr</code> (Authentication Context Class Reference) claim.</li>
<li>
<code>extra_token_headers</code> are now consistently applied to revoke and introspect requests, matching the existing behavior for token exchange and refresh. Previously, provider integrations requiring custom headers across all token endpoints could partially fail on revocation/introspection.</li>
<li>Fixed incorrect warning about client being created in Shiny when this was not the case.</li>
<li>Malformed <code>client_assertion_alg</code> and <code>client_assertion_audience</code> values (e.g., <code>character(0)</code>, multi-element vectors) now produce clear validation errors instead of crashing with base R subscript-out-of-bounds errors. Empty string <code>""</code> for <code>client_assertion_audience</code> is now explicitly rejected instead of being silently treated as “not provided”.</li>
</ul></li>
<li>
<p><code>OAuthToken</code> (S7 class):</p>
<ul><li>Gains a read-only <code>id_token_claims</code> property that exposes the decoded ID token JWT payload as a named list, surfacing all OIDC claims (e.g., <code>acr</code>, <code>amr</code>, <code>auth_time</code>) without manual decoding.</li>
<li>Gains an <code>id_token_validated</code> property (logical) indicating whether the ID token was cryptographically verified during the OAuth flow.</li>
</ul></li>
<li>
<p><code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>:</p>
<ul><li>Now surfaces <code>error_uri</code> from provider error callbacks (RFC 6749, section 4.1.2.1). The new <code>$error_uri</code> reactive field contains the URI to a human-readable error page when the provider includes one; <code>NULL</code> otherwise. The <code>error_uri</code> callback parameter is also validated against a configurable size limit (e.g., <code>options(shinyOAuth.callback_max_error_uri_bytes = 2048)</code>).</li>
<li>OAuth callback query cleanup is now also applied in early return paths of internal function <code>.process_query()</code>, ensuring more consistent cleanup.</li>
<li>OAuth callback query size caps are now enforced even when the user is already authenticated. Previously, the “token already present” branch in <code>.process_query()</code> called <code>.query_has_oauth_callback_keys()</code> (which parses the query string) before any size validation, bypassing the intended DoS guardrails. The <code>validate_untrusted_query_string()</code> check now runs unconditionally at the top of <code>.process_query()</code>.</li>
<li>OAuth callback error responses (<code>?error=...</code>) now require a valid <code>state</code> parameter. Missing/invalid/consumed state is then treated properly as an <code>invalid_state</code> error instead of surfacing the error from <code>?error=...</code> (which could be set by an attacker).</li>
<li>OAuth callback including an <code>iss</code> query parameter now validate this against the provider’s configured/discovered issuer during callback processing (complementing the existing ID token <code>iss</code> claim validation that occurs post-exchange) (per RFC 9207). A mismatch produces an <code>issuer_mismatch</code> error and audit event, defending against authorization-server mix-up attacks in multi-provider scenarios. When <code>iss</code> is absent, current behavior is retained (no enforcement).</li>
</ul></li>
<li><p><code><a href="../reference/handle_callback.html">handle_callback()</a></code>: no longer accepts <code>decrypted_payload</code> and <code>state_store_values</code> bypass parameters. These parameters were only intended for internal use by <code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>’s async path. As they can be misused by direct/custom callers to bypass important security checks, they have been moved to an internal-only helper function (<code>handle_callback_internal()</code>).</p></li>
<li><p><code><a href="../reference/handle_callback.html">handle_callback()</a></code>/<code><a href="../reference/refresh_token.html">refresh_token()</a></code>: when a token response omits <code>expires_in</code>, a warning is now emitted once per phase (<code>exchange_code</code> / <code>refresh_token</code>) so operators know that proactive token refresh will not trigger. Users can now also set a finite default lifetime for such tokens via <code>options(shinyOAuth.default_expires_in = &lt;seconds&gt;)</code> (instead of the default of <code>Inf</code>).</p></li>
<li><p><code><a href="../reference/get_userinfo.html">get_userinfo()</a></code> now supports JWT-encoded userinfo responses per OIDC Core, section 5.3.2. When the endpoint returns <code>Content-Type: application/jwt</code>, the body is decoded as a JWT. Verification is fail-closed: signature verification is always performed against the provider JWKS using the provider’s <code>allowed_algs</code>, <code>alg=none</code> is always rejected, and unparseable headers, non-asymmetric algorithms, or missing issuer/JWKS infrastructure all raise errors. <code>options(shinyOAuth.allow_unsigned_userinfo_jwt = TRUE)</code> permits unsigned JWTs. New <code>userinfo_signed_jwt_required</code> property on <code>OAuthProvider</code> (default <code>FALSE</code>) mandates that the userinfo endpoint returns <code>application/jwt</code> content-type which is then subject to the above verification.</p></li>
<li><p><code><a href="../reference/client_bearer_req.html">client_bearer_req()</a></code> now validates the target URL against <code><a href="../reference/is_ok_host.html">is_ok_host()</a></code> before attaching the Bearer token. Relative URLs, plain HTTP to non-loopback hosts, and hosts outside <code>options(shinyOAuth.allowed_hosts)</code> are rejected by default. A new <code>check_url</code> argument (default <code>TRUE</code>) allows opting out of the check when the URL has already been validated.</p></li>
<li><p><code>err_http()</code> now extracts RFC 6749 section 5.2 structured error fields (<code>error</code>, <code>error_description</code>, <code>error_uri</code>) from JSON error response bodies. These fields are surfaced in the error message bullets, attached to the condition object (as <code>oauth_error</code>, <code>oauth_error_description</code>, <code>oauth_error_uri</code>), and included in trace/audit events. This improves debugging of token endpoint failures (e.g. <code>invalid_grant</code>, <code>invalid_client</code>) without changing existing control flow.</p></li>
<li><p>OIDC <code>claims</code> parameter support (OIDC Core, section 5.5): <code>OAuthClient</code> and <code><a href="../reference/oauth_client.html">oauth_client()</a></code> now accept a <code>claims</code> argument to request specific claims from the userinfo Endpoint and/or in the ID token. Pass a list structure (automatically JSON-encoded) or a pre-encoded JSON string.</p></li>
<li><p>OIDC <code>openid</code> scope enforcement: when a provider has an <code>issuer</code> set (indicating OIDC) and <code>openid</code> is missing from the client’s scopes, <code>build_auth_url()</code> now auto-prepends it and emits a one-time warning.</p></li>
<li><p>OIDC discovery (<code><a href="../reference/oauth_provider_oidc_discover.html">oauth_provider_oidc_discover()</a></code>) now prefers confidential auth methods (<code>client_secret_basic</code>, <code>client_secret_post</code>) over <code>none</code> when both are advertised in <code>token_endpoint_auth_methods_supported</code>. Previously, mixed metadata (e.g. <code>none</code> + <code>client_secret_basic</code>) with PKCE enabled would silently select the public-client posture (<code>"body"</code> without credentials).</p></li>
<li><p>Scope validation now aligns with the RFC 6749, section 3.3 <code>scope-token</code> grammar (<code>NQSCHAR = %x21 / %x23-5B / %x5D-7E</code>). The previous regex rejected valid ASCII characters such as <code>!</code>, <code>#</code>, <code>$</code>, <code>=</code>, <code>@</code>, <code>~</code>, and others. All printable ASCII except space, double-quote, and backslash is now accepted.</p></li>
<li><p>JWT helpers (<code>build_client_assertion()</code>, <code>resolve_client_assertion_audience()</code>) now have defense-in-depth scalar guards so malformed property values cannot cause subscript errors at runtime.</p></li>
<li>
<p>Audit events:</p>
<ul><li>
<code>audit_token_refresh</code>: replaced non-informative <code>had_refresh_token</code> field (always <code>TRUE</code> post-mutation) with <code>refresh_token_rotated</code> (indicates whether the provider returned a new refresh token).</li>
</ul></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.3.0" id="shinyoauth-030">shinyOAuth 0.3.0<a class="anchor" aria-label="anchor" href="#shinyoauth-030"></a></h2><p class="text-muted">CRAN release: 2026-01-30</p>
<ul><li><p>Async backend: the default async backend is now ‘mirai’ (&gt;= 2.0.0) for simpler and more efficient asynchronous execution. Use <code><a href="https://mirai.r-lib.org/reference/daemons.html" class="external-link">mirai::daemons()</a></code> to configure async workers. A ‘future’ backend configured with <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> is still supported, but ‘mirai’ takes precedence if both are configured.</p></li>
<li><p>Test suite: fixed inconsistent results of several tests; tests not suitable for CRAN now skip on CRAN. Silenced test output messages to avoid confusion.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.2.0" id="shinyoauth-020">shinyOAuth 0.2.0<a class="anchor" aria-label="anchor" href="#shinyoauth-020"></a></h2><p class="text-muted">CRAN release: 2026-01-13</p>
<div class="section level3">
<h3 id="newimproved-0-2-0">New/improved<a class="anchor" aria-label="anchor" href="#newimproved-0-2-0"></a></h3>
<div class="section level4">
<h4 id="security-0-2-0">Security<a class="anchor" aria-label="anchor" href="#security-0-2-0"></a></h4>
<ul><li><p>Token revocation: tokens can now be revoked when Shiny session ends. Enable via <code>revoke_on_session_end = TRUE</code> in <code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>. The provider must expose a <code>revocation_url</code> (auto-discovered for OIDC, or set manually via <code><a href="../reference/oauth_provider.html">oauth_provider()</a></code>). New exported function <code><a href="../reference/revoke_token.html">revoke_token()</a></code>.</p></li>
<li><p>Token introspection on login: validate tokens via the provider’s introspection endpoint during login. Configure via <code>introspect</code> and <code>introspect_elements</code> properties on <code>OAuthClient</code>. The provider must expose an <code>introspection_url</code> (auto-discovered for OIDC, or set manually via <code><a href="../reference/oauth_provider.html">oauth_provider()</a></code>).</p></li>
<li><p>DoS protection: callback query parameters and state payload/browser token sizes are validated before expensive operations (e.g., hashing for audit logs). Maximum size may be configured via <code><a href="https://rdrr.io/r/base/options.html" class="external-link">options()</a></code>; see section ‘Size caps’ in <code><a href="../articles/usage.html">vignette("usage", package = "shinyOAuth")</a></code>.</p></li>
<li><p>DoS protection: rate-limited JWKS refresh: forced JWKS cache refreshes (triggered by unknown <code>kid</code>) are now rate-limited to prevent abuse.</p></li>
<li><p>JWKS pinning: pinning is now enforced during signature verification: previously, <code>jwks_pins</code> with <code>jwks_pin_mode = "any"</code> only verified that at least one key in the JWKS matched a pin, but signature verification could still use any matching key (pinned or not). Now, signature verification is restricted to only use keys whose thumbprints appear in the pin list, ensuring true key pinning rather than presence-only checks.</p></li>
<li><p><code><a href="../reference/use_shinyOAuth.html">use_shinyOAuth()</a></code> now injects <code>&lt;meta name="referrer" content="no-referrer"&gt;</code> by default to reduce leaking ?code=…&amp;state=… via the Referer header on the callback page. Can be disabled with <code>use_shinyOAuth(inject_referrer_meta = FALSE)</code>.</p></li>
<li><p>Sensitive outbound HTTP requests (token exchange/refresh, introspection, revocation, userinfo, OIDC discovery, JWKS) now by default disable redirect following and reject 3xx responses to prevent bypassing host/HTTPS policies. Configurable via <code>options(shinyOAuth.allow_redirect = TRUE)</code>. <code><a href="../reference/client_bearer_req.html">client_bearer_req()</a></code> also gains <code>follow_redirect</code>, which defaults to <code>FALSE</code>, to similarly control redirect behavior for requests using bearer tokens.</p></li>
<li><p>State is now also consumed in login failure paths (when the provider returns an error but also a state).</p></li>
<li><p>Callback URL parameters are now also cleared in login failure paths.</p></li>
<li><p><code>OAuthProvider</code> now requires absolute URLs (scheme + hostname) for all endpoint URLs.</p></li>
<li><p>Provider fingerprint now includes <code>userinfo_url</code> and <code>introspection_url</code>, reducing risk of misconfiguration when multiple providers share endpoints.</p></li>
<li><p><code>state_payload_max_age</code> property on <code>OAuthClient</code> for independent freshness validation of the state payload’s <code>issued_at</code> timestamp.</p></li>
<li><p>Default client assertion JWT TTL reduced from 5 minutes to 120 seconds, reducing the window for replay attacks while allowing for clock skew.</p></li>
</ul></div>
<div class="section level4">
<h4 id="auditing-0-2-0">Auditing<a class="anchor" aria-label="anchor" href="#auditing-0-2-0"></a></h4>
<ul><li><p>New audit events: <code>session_ended</code> (logged on Shiny session close), <code>authenticated_changed</code> (logged when authentication status changes), <code>token_introspection</code> (when <code><a href="../reference/introspect_token.html">introspect_token()</a></code> is used), <code>token_revocation</code> (when <code><a href="../reference/revoke_token.html">revoke_token()</a></code> is used), <code>error_state_consumed</code> and <code>error_state_consumption_failed</code> (called when provider returns an error during callback handling and the state is attempted to be consumed).</p></li>
<li><p>All audit events now include <code>$process_id</code>, <code>$is_async</code>, and <code>$main_process_id</code> (if called from an async worker); these fields help identify which process generated the event and whether it was from an async worker. Async workers now also properly propagate audit hooks from the main process (see ‘Fixed’).</p></li>
<li><p>Audit event <code>login_success</code> now includes <code>sub_source</code> to indicate whether the subject digest came from <code>userinfo</code>, <code>id_token</code> (verified), or <code>id_token_unverified</code>.</p></li>
<li><p>Audit digest keying: audit/event digests (e.g., <code>sub_digest</code>, <code>browser_token_digest</code>) now default to HMAC-SHA256 with an auto-generated per-process key to reduce reidentification/correlation risk if logs leak. Configure a key with <code>options(shinyOAuth.audit_digest_key = "...")</code>, or disable keying (legacy deterministic SHA-256) with <code>options(shinyOAuth.audit_digest_key = FALSE)</code>.</p></li>
<li><p>HTTP log sanitization: sensitive data in HTTP contexts (headers, cookies) is now sanitized by default in audit logs. Can be disabled with <code>options(shinyOAuth.audit_redact_http = FALSE)</code>. Use <code>options(shinyOAuth.audit_include_http = FALSE)</code> to not include any HTTP data in logs.</p></li>
</ul></div>
<div class="section level4">
<h4 id="ux-0-2-0">UX<a class="anchor" aria-label="anchor" href="#ux-0-2-0"></a></h4>
<ul><li><p>Configurable scope validation: <code>validate_scopes</code> property on <code>OAuthClient</code> controls whether returned scopes are validated against requested scopes (<code>"strict"</code>, <code>"warn"</code>, or <code>"none"</code>). Scopes are now normalized (alphabetically sorted) before comparison.</p></li>
<li><p><code>OAuthProvider</code>: extra parameters are now blocked from overriding reserved keys essential for the OAuth 2.0/OIDC flow. Reserved keys may be explicitly overridden via <code>options(shinyOAuth.unblock_auth_params = c(...), shinyOAuth.unblock_token_params = c(...), shinyOAuth.unblock_token_headers = c(...))</code>. It is also validated early that all parameters are named, catching configuration errors sooner.</p></li>
<li><p>Added warning about negative <code>expires_in</code> values in token responses.</p></li>
<li><p>Added warning when <code>OAuthClient</code> is instantiated inside a Shiny session; may cause sealed state payload decryption to fail when random secret is generated upon client creation.</p></li>
<li><p>Added hints in error messages when sealed state payload decryption fails.</p></li>
<li><p>Ensured a clearer error message when token response is in unexpected format.</p></li>
<li><p>Ensured a clearer error when retrieved state store entry is in unexpected format.</p></li>
<li><p>Ensured a clearer error message when retrieved userinfo cannot be parsed as JSON.</p></li>
<li><p>Immediate error when <code>OAuthProvider</code> uses <code>HS*</code> algorithm but <code>options(shinyOAuth.allow_hs = TRUE)</code> is not enabled; also immediate error when <code>OAuthProvider</code> uses <code>HS*</code> algorithm and ID token verification can happen but <code>client_secret</code> is absent or too weak.</p></li>
<li><p><code>build_auth_url()</code> now uses package-typed errors (<code>err_invalid_state()</code>) instead of generic <code><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot()</a></code> assertions, ensuring consistent error handling and audit logging.</p></li>
</ul></div>
<div class="section level4">
<h4 id="other-0-2-0">Other<a class="anchor" aria-label="anchor" href="#other-0-2-0"></a></h4>
<ul><li><p>ID token signature/claims validation now occurs before fetching userinfo. This ensures cryptographic validation passes before making external calls to the userinfo endpoint.</p></li>
<li><p>When fetching JWKS, if <code>key_ops</code> is present on keys, only keys with <code>key_ops</code> including <code>"verify"</code> are considered.</p></li>
<li><p><code><a href="../reference/oauth_provider.html">oauth_provider()</a></code> now defaults <code>allowed_token_types</code> to <code>c("Bearer")</code> for all providers. This prevents accidentally misusing non-Bearer tokens (e.g., DPoP, MAC) as Bearer tokens. Set <code>allowed_token_types = character()</code> to opt out. Token type is also now validated before calling the userinfo endpoint.</p></li>
<li><p><code>client_assertion_audience</code> property on <code>OAuthClient</code> allows overriding the JWT audience claim for client assertion authentication.</p></li>
</ul></div>
</div>
<div class="section level3">
<h3 id="fixed-0-2-0">Fixed<a class="anchor" aria-label="anchor" href="#fixed-0-2-0"></a></h3>
<ul><li><p>Package now correctly requires <code>httr2</code> &gt;= 1.1.0.</p></li>
<li><p><code>authenticated</code> now flips to <code>FALSE</code> promptly when a token expires or <code>reauth_after_seconds</code> elapses, even without other reactive changes. Previously, the value could remain <code>TRUE</code> past expiry until an unrelated reactive update triggered re-evaluation.</p></li>
<li><p>HTTP error responses (4xx/5xx) are now correctly returned to the caller immediately instead of being misclassified as transport errors and retried.</p></li>
<li><p>Async worker options propagation: all R options are now automatically propagated to async workers when using <code>async = TRUE</code>. Previously, options set in the main process (including <code>audit_hook</code>, <code>trace_hook</code>, HTTP settings, and any custom options) were not available in <code><a href="https://future.futureverse.org/reference/multisession.html" class="external-link">future::multisession</a></code> workers.</p></li>
<li><p><code><a href="../reference/oauth_provider_microsoft.html">oauth_provider_microsoft()</a></code>: fixed incorrect default which blocked multi-tenant configuration.</p></li>
<li><p><code><a href="../reference/oauth_provider_oidc_discover.html">oauth_provider_oidc_discover()</a></code>: stricter host matching; <code>?</code> and <code>*</code> wildcards now correctly handled.</p></li>
<li><p>Fixed potential auto-redirect loop after authentication error has surfaced.</p></li>
<li><p>Fixed potential race condition between proactive refresh and expiry watcher: the expiry watcher now defers clearing the token and triggering reauthentication while a refresh is in progress.</p></li>
<li><p>Token expiry handling during token refresh now aligns with how it is handled during login.</p></li>
<li><p>State payload <code>issued_at</code> validation now applies clock drift leeway (from <code>OAuthProvider@leeway</code> / <code>shinyOAuth.leeway</code> option), consistent with ID token <code>iat</code> check.</p></li>
</ul></div>
</div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.4" id="shinyoauth-014">shinyOAuth 0.1.4<a class="anchor" aria-label="anchor" href="#shinyoauth-014"></a></h2><p class="text-muted">CRAN release: 2025-11-24</p>
<ul><li><p>Added a console warning about needing to access Shiny apps with <code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code> in a regular browser; also updated examples and vignettes to further clarify this.</p></li>
<li><p><code><a href="../reference/oauth_module_server.html">oauth_module_server()</a></code>: improved formatting style of warning messages (now consistent with error messages).</p></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.3" id="shinyoauth-013">shinyOAuth 0.1.3<a class="anchor" aria-label="anchor" href="#shinyoauth-013"></a></h2><p class="text-muted">CRAN release: 2025-11-10</p>
<ul><li><p>Rewrote <code><a href="../articles/authentication-flow.html">vignette("authentication-flow")</a></code> to improve clarity.</p></li>
<li><p>Skip timing-sensitive tests on CRAN.</p></li>
</ul></div>
    <div class="section level2">
<h2 class="pkg-version" data-toc-text="0.1.1" id="shinyoauth-011">shinyOAuth 0.1.1<a class="anchor" aria-label="anchor" href="#shinyoauth-011"></a></h2><p class="text-muted">CRAN release: 2025-11-09</p>
<ul><li>Initial CRAN submission.</li>
</ul></div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luka Koning.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

